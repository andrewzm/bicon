---
title: "Causal Spatial Models"
author: "Andrew Zammit Mangion"
date: "28 February 2015"
output: beamer_presentation
fig_width: 7
fig_height: 6
fig_caption: true
bibliography: ../vignettes/Bibliography.bib
header-includes: 
    - \usepackage{natbib}
    - \usepackage{tikz}
csl: ../vignettes/apa.csl
Extension: raw_tex
---




## Introduction

\newcommand{\Yt}{\widetilde{Y}}                     
\newcommand{\Deltab} {\boldsymbol{\Delta}}
\newcommand{\intd} {\mathrm{d}}                 
\newcommand{\Bmat} {\textbf{B}}                 
\newcommand{\Cmat} {\textbf{C}}                 
\newcommand{\cmat} {\textbf{c}}                 
\newcommand{\Imat} {\textbf{I}}                 
\newcommand{\bvec} {\textbf{b}}                 
\newcommand{\svec} {\textbf{s}}                 
\newcommand{\uvec} {\textbf{u}}                 
\newcommand{\omegab} {\boldsymbol {\omega}}     
\newcommand{\s}{\mathbf{s}}                     
\newcommand{\h}{\mathbf{h}}                     
\renewcommand{\b}{\mathbf{b}}                   
\newcommand{\z}{\mathbf{z}}                     
\renewcommand{\v}{\mathbf{v}}                   
\renewcommand{\u}{\mathbf{u}}                   
\newcommand{\w}{\mathbf{w}}                     
\renewcommand{\d}{\mathrm{d}}                   
\newcommand{\Z}{\mathbf{Z}}                     
\newcommand{\x}{\mathbf{x}}                   
\newcommand{\Y}{\mathbf{Y}}                     
\newcommand{\Yvec}{\mathbf{Y}}                  
\newcommand{\Zvec}{\mathbf{Z}}                  
\newcommand{\epsilonb}{\boldsymbol{\varepsilon}}
\newcommand{\bI}{\mathbf{I}}                    
\newcommand{\bB}{\mathbf{B}}                    
\newcommand{\bbeta}{\boldsymbol{\beta}}         
\newcommand{\bzero}{\boldsymbol{0}}             
\newcommand{\bSigma}{\bm{\Sigma}}               
\newcommand{\E}{E}                              
\newcommand{\cov}{\mathrm{cov}}                 
\newcommand{\var}{\mathrm{var}}                 
\newcommand{\tr}{\mathrm{tr}}                   
\newcommand{\diag}{\mathrm{diag}}               
\newcommand{\vect}{\mathrm{vec}}                
\newcommand{\Gau}{\mathrm{Gau}}                 
\newcommand{\RR}{\mathbb{R}}     


- **Univariate** spatial models

- **Multivariate** spatial models
    - Two or more interacting spatial variates
    - Improve prediction on one of the variates by observing the others: **Cokriging**
    - Determine which variate caused the observed phenomenon: **Source separation**

## Example 1: Ozone vs MaxT

- @RoyleBerliner1999, Midwestern USA.

\includegraphics[width=2.5in]{./ozone.png}                                            \includegraphics[width=2.3in]{./maxt.png}  


## Example 2: Antarctica Mass Balance

\includegraphics[width=4.5in]{./Antarctica.png}        

## Example 2: Antarctica Mass Balance

\begin{center}
\includegraphics[width=4in]{./Obs.png}        
\end{center}

- @Zammit_2014
- @Zammit_2015a
- @Zammit_2015b

## The challenge

- **Modelling**: Given a bivariate process $(Y_1(\cdot), Y_2(\cdot))$, what is a valid *cross-covariance function matrix* (CCFM)
  
\begin{equation}
\left(\begin{array}{cc} C_{11}(\cdot,\cdot) & C_{12}(\cdot,\cdot) \\ C_{21}(\cdot,\cdot) & C_{22}(\cdot,\cdot)\end{array} \right)
\end{equation}

such that *any* covariance matrix derived from it is positive-definite?

- **Computational**: Sometimes we struggle with univariate models -- how do we scale up?

## Current approaches

- **Linear Model of co-regionalisation** (Wackernagel, 1993): Define
  
\begin{align}
    Y_1(\cdot) &= a_{11}\Yt_1(\cdot) + a_{12}\Yt_2(\cdot),\\
    Y_2(\cdot) &= a_{21}\Yt_1(\cdot) + a_{22}\Yt_2(\cdot). 
\end{align}

where
  
\begin{align}
    \Yt_1(\cdot) &\sim (\mu_1(\cdot), C_{1}(\cdot,\cdot)),\\
    \Yt_2(\cdot) &\sim (\mu_2(\cdot), C_{2}(\cdot,\cdot)).
\end{align}

  - $C_{ij}(\cdot,\cdot) = a_{i1}a_{j1}C_{1}(\cdot,\cdot) + a_{i2}a_{j2}C_{2}(\cdot,\cdot)$.
  
  - CCFM is positive definite for any $\{a_{ij}: i,j = 1,\dots,2\}$. 


##Current approaches

- **Bivariate parsimonious Matérn model** [@Gneitingetal2010]: Let $C^o(\cdot)$ be a stationary, isotropic covariance function. Define
  
\begin{align}
    C_{ii}^o(\cdot) \equiv M(\cdot; \nu_i, \kappa_i)
    C_{ij}^o(\cdot) \beta_{ij}\equiv M(\cdot; \nu_{ij}, \kappa_{ij})
\end{align}

 where $M(\cdot)$ is a Matérn covariance function. If we let $\kappa_i = \kappa_{ij} = \kappa$ and set $\nu_{ij} = (\nu_i + \nu_j)/2$ then if  $(\beta_{ij},i,j = 1,2)'$ is positive definite, the CCFM is positive definite.
  
- **Bivariate full Matérn model**:  Relaxes assumptions on smoothness and scales, but finding eligible values is much more involved.
  
##Current approaches (Limitations)

- Stuck with homogeneous models (e.g. convolution methods)
- Stuck with fixed scales (parsimonious Matérn)
- Stuck with Matérn models (e.g. full Matérn models)
- **Stuck with symmetry (e.g. LMC)**

##Asymmetry

$Y_1(\cdot)$: rain now        
$Y_2(\cdot)$: rain in 5 minutes time

![alt text](rain.jpg)

## Causal spatial models

\begin{align}\label{eqn:E-and-cov}                                                          \E\left(Y_2(\s)\mid Y_1(\cdot)\right)&\,=\int_D{b(\s,\v)Y_1(\v)\,\d \v};\quad \s\in D,\\   
&\\
&\\
\cov\left(Y_2(\s),Y_2(\u)\mid Y_1(\cdot)\right)&\,=C_{2\mid 1}(\s,\u);\quad \s,\u\in \mathbb{R}^d.\nonumber     \end{align}   


Building blocks:

  - $C_{11}(\cdot,\cdot)$
  - $C_{2|1}(\cdot,\cdot)$
  - $b(\cdot,\cdot)$ (interaction function)

## Properties of causal spatial models

-  CCFM is easy to find:

$$
\begin{bmatrix} C_{11}(\s,\u) & \int_DC_{11}(\s,\v)b(\u,\v)\d\v \\ \int_Db(\s,\v)C_{11}(\v,\u)\d\v & ~~~~~C_{22}(\s,\u)\end{bmatrix};                     $$
$$
\small
C_{22}(\s,\u) = C_{2\mid 1}(\s,\u)+\int_D\int_D b(\s,\v)C_{11}(\v,\w)b(\w,\u)\d\v\d\w 
$$

and is always valid (proof to appear).

- Asymmetry is guaranteed if $b(\cdot,\cdot)$ is not symmetric

## Properties of causal spatial models

- Assume $b^o(\cdot) = b(\cdot,\cdot)$ and that it is off-centre
- $\s,\u \in \{-1, -0.9 ,\dots, 1\}$

\begin{center}
\includegraphics[width=3in]{Sigma.png}
\end{center}

## Properties of causal spatial models {.build}

- Heterogeneity since $C_{11}(\cdot,\cdot)$, $C_{2|1}(\cdot,\cdot)$ need not be heterogeneous and $b(\svec,\uvec)$ need not be symmetric.

- We are not restricted to Matérn fields. The bivariate parsimonious Matérn field is a **special case**.

- $Y_2(\cdot)$ can be arbitrarily smoother than $Y_1(\cdot)$ *and* have a different scale.


## Graphical structure

\begin{figure}[!t]
\begin{center}
\begin{tikzpicture}[scale=1,every node/.style={transform shape}]
%[inner sep=1mm]                                                                                                                                                                                               
[line width=2pt]
\draw (0,0) node(psib) {$\left. \begin{array}{l}  \psi \\ ~ \\ BC \end{array} \right\}$};
\draw (2,0) node(xM) {$x$};
\draw (4,0) node(x) {$z$};
\draw (5.5,0) node(z) {$z$};
\draw (3,1) node(thetab) {$\theta$};
\draw (1.2,0.3) node(g) {$g(\cdot)$};

\draw [->] (thetab) to (xM);
\draw [->] (thetab) to (x);
\draw [->] (psib) to (xM);
\draw [->] (x) to (z);


\end{tikzpicture}
\caption{Assumed .}\label{fig:exchangeable}
\end{center}
\end{figure}


Chains
Not limited to chains
Number of free functions = number of elements in CCFM

## References
